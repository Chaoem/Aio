<!DOCTYPE html>
<html lang="vi">
<head>
<meta charset="UTF-8">
<meta name="viewport" content="width=device-width, initial-scale=1.0">
<title>Advanced Catbox Player</title>
<style>
body {
  margin:0;
  font-family: Arial, sans-serif;
  background:#121212;
  color:white;
  display:flex;
  justify-content:center;
  padding:10px;
}
.container {
  width:95%;
  max-width:450px;
  background:#1e1e1e;
  border-radius:16px;
  padding:20px;
  box-shadow:0 0 15px rgba(255,255,255,0.1);
  position:relative;
}
h2 {text-align:center;margin-bottom:15px;}
#search {width:100%;padding:12px;border-radius:10px;border:none;font-size:16px;background:#2b2b2b;color:white;margin-bottom:15px;}
.song {padding:12px;margin-bottom:5px;background:#2b2b2b;border-radius:10px;cursor:pointer;transition:0.2s;}
.song:hover {background:#3a3a3a;}
.active {border-left:4px solid #ff5722;}
.controls {display:flex;justify-content:space-around;margin-top:15px;}
.btn {padding:10px 20px;background:#ff5722;color:white;border:none;border-radius:10px;cursor:pointer;font-size:18px;}
.btn:hover {background:#ff784e;}
.menu-btn {position:absolute;top:20px;right:20px;width:30px;height:25px;cursor:pointer;display:flex;flex-direction:column;justify-content:space-between;}
.menu-btn div {height:4px;background:white;border-radius:2px;}
.menu-content {position:absolute;top:50px;right:20px;background:#2b2b2b;padding:10px;border-radius:10px;display:none;flex-direction:column;min-width:120px;}
.menu-content div {padding:10px;cursor:pointer;border-bottom:1px solid #444;}
.menu-content div:last-child{border:none;}
.menu-content div:hover{background:#3a3a3a;}
</style>
</head>
<body>

<div class="container">
  <h2>üéµ Advanced Catbox Player</h2>

  <!-- Hamburger -->
  <div class="menu-btn" onclick="toggleMenu()">
    <div></div><div></div><div></div>
  </div>
  <div class="menu-content" id="menuContent">
    <div onclick="showMain()">Main</div>
    <div onclick="showHistory()">History</div>
  </div>

  <div id="mainContent">
    <input id="search" type="text" placeholder="üîç Search...">

    <div id="playlist"></div>

    <div class="controls">
      <button class="btn" onclick="prevAudio()">‚èÆÔ∏è</button>
      <button class="btn" id="playPauseBtn" onclick="togglePlay()">‚ñ∂Ô∏è</button>
      <button class="btn" onclick="nextAudio()">‚è≠Ô∏è</button>
    </div>
  </div>

  <div id="historyContent" style="display:none;">
    <h3>L·ªãch s·ª≠ nghe</h3>
    <ul id="historyList"></ul>
  </div>

  <audio id="player"></audio>
</div>

<script>
// üîπ Playlist
let playlist = [
  { title: "C√°o R√©o", url: "https://files.catbox.moe/n4hdcs.mp3" },
  { title: "Nh·∫°c Chill", url: "https://files.catbox.moe/xxxxx.mp3" },
  { title: "Remix CƒÉng", url: "https://files.catbox.moe/yyyyy.mp3" }
];

const audio = document.getElementById("player");
const playlistDiv = document.getElementById("playlist");
const searchBox = document.getElementById("search");
const historyList = document.getElementById("historyList");
const playPauseBtn = document.getElementById("playPauseBtn");

let index = 0;
let history = JSON.parse(localStorage.getItem("history")) || [];

// üîπ H√†m b·ªè d·∫•u
function noAccent(str){
  return str.normalize("NFD").replace(/[\u0300-\u036f]/g,"").replace(/ƒë/g,"d").replace(/ƒê/g,"D").toLowerCase();
}

// üîπ Render playlist (lu√¥n hi·ªÉn th·ªã t·∫•t c·∫£, search ch·ªâ highlight)
function renderPlaylist(filter){
  playlistDiv.innerHTML="";
  playlist.forEach((song,i)=>{
    const div=document.createElement("div");
    div.className="song"+(i===index?" active":"");
    div.textContent=song.title;

    // highlight n·∫øu filter tr√πng
    if(filter && noAccent(song.title).includes(noAccent(filter))){
      div.style.background="#ff5722";
    } else {
      div.style.background="#2b2b2b";
    }

    div.onclick=()=>{
      index=i;
      loadSong(i);
    };
    playlistDiv.appendChild(div);
  });
}

// üîπ Load b√†i
function loadSong(i){
  audio.src=playlist[i].url;
  audio.play();
  updatePlayButton();
  highlight();
  saveHistory(i,audio.currentTime);
}

// üîπ Controls
function togglePlay(){
  if(audio.paused){ audio.play(); updatePlayButton(); }
  else{ audio.pause(); updatePlayButton(); }
}
function playAudio(){ audio.play(); updatePlayButton();}
function pauseAudio(){ audio.pause(); updatePlayButton();}
function nextAudio(){ index=(index+1)%playlist.length; loadSong(index);}
function prevAudio(){ index=(index-1+playlist.length)%playlist.length; loadSong(index);}
audio.addEventListener("ended", nextAudio);

// üîπ Highlight
function highlight(){
  document.querySelectorAll(".song").forEach((e,i)=>{e.classList.toggle("active",i===index);});
}

// üîπ Update n√∫t play/pause
function updatePlayButton(){
  playPauseBtn.textContent = audio.paused ? "‚ñ∂Ô∏è" : "‚è∏Ô∏è";
}

// üîπ Search
searchBox.addEventListener("input",()=>{ renderPlaylist(searchBox.value); });

// üîπ Menu
function toggleMenu(){
  const menu=document.getElementById("menuContent");
  menu.style.display=menu.style.display==="flex"?"none":"flex";
}
function showMain(){ document.getElementById("mainContent").style.display="block"; document.getElementById("historyContent").style.display="none"; renderPlaylist(searchBox.value);}
function showHistory(){ document.getElementById("mainContent").style.display="none"; document.getElementById("historyContent").style.display="block"; renderHistory(); }

// üîπ History
function saveHistory(i,time){
  const song=playlist[i];
  const exists=history.find(h=>h.url===song.url);
  if(exists){ exists.time=time; }
  else{ history.unshift({title:song.title,url:song.url,time:time}); if(history.length>50) history.pop(); }
  localStorage.setItem("history",JSON.stringify(history));
}

// üîπ Render history
function renderHistory(){
  historyList.innerHTML="";
  history.forEach((h)=>{
    const li=document.createElement("li");
    li.textContent=`${h.title} - ${formatTime(h.time||0)}`;
    li.style.cursor="pointer";
    li.onclick=()=>{
      const idx=playlist.findIndex(p=>p.url===h.url);
      if(idx!==-1){ index=idx; loadSong(index); audio.currentTime=h.time||0; showMain();}
    };
    historyList.appendChild(li);
  });
}

// üîπ Format time
function formatTime(t){
  const min=Math.floor(t/60);
  const sec=Math.floor(t%60);
  return `${min}:${sec<10?"0"+sec:sec}`;
}

// üîπ Load l·∫ßn cu·ªëi
let lastIndex=localStorage.getItem("lastIndex");
let lastTime=localStorage.getItem("lastTime");
if(lastIndex!==null){ index=parseInt(lastIndex); loadSong(index); audio.currentTime=lastTime?parseFloat(lastTime):0; } 
else loadSong(0);

// üîπ L∆∞u th·ªùi gian li√™n t·ª•c
setInterval(()=>{ 
  saveHistory(index,audio.currentTime); 
  localStorage.setItem("lastIndex",index); 
  localStorage.setItem("lastTime",audio.currentTime); 
},2000);
</script>

</body>
</html>
