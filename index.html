<!DOCTYPE html>
<html lang="vi">
<head>
<meta charset="UTF-8">
<title>Video ‚Üí MP3 ‚Üí D·ªãch ‚Üí Copy All</title>
<script src="https://cdn.jsdelivr.net/npm/@ffmpeg/ffmpeg@0.12.2/dist/ffmpeg.min.js"></script>
<script src="https://cdn.jsdelivr.net/npm/whisper-tiny/dist/whisper-tiny.min.js"></script>
<script src="https://cdn.jsdelivr.net/npm/translate.js@1.0.0/translate.min.js"></script>
<style>
body { font-family: Arial; background:#111; color:#fff; padding:20px; }
button { padding:10px 20px; margin:10px 0; cursor:pointer; }
textarea, input { width:100%; margin-top:10px; background:#222; color:#0f0; padding:10px; border:none; }
</style>
</head>
<body>

<h2>üé¨ Video ‚Üí MP3 ‚Üí D·ªãch Ti·∫øng Trung ‚Üí Ti·∫øng Vi·ªát</h2>

<input type="file" id="videoInput" accept="video/*"><br>
<p id="status">Ch∆∞a ch·ªçn video</p>
<button onclick="processVideo()">Ch·∫°y quy tr√¨nh</button>

<h3>Ti·∫øng Trung nh·∫≠n di·ªán:</h3>
<textarea id="chinaText" placeholder="Text ti·∫øng Trung"></textarea>

<h3>Ti·∫øng Vi·ªát d·ªãch:</h3>
<textarea id="vietText" placeholder="Text ti·∫øng Vi·ªát"></textarea>

<h3>Input vƒÉn b·∫£n cu·ªëi:</h3>
<input type="text" id="vietInput" placeholder="C√≥ th·ªÉ ch·ªânh s·ª≠a ho·∫∑c copy vƒÉn b·∫£n">

<button onclick="copyAll()">üìã Copy All</button>

<script>
const { createFFmpeg, fetchFile } = FFmpeg;
const ffmpeg = createFFmpeg({ log:true });
let videoFile = null;

document.getElementById("videoInput").addEventListener("change", e=>{
    videoFile = e.target.files[0];
    document.getElementById("status").innerText = "ƒê√£ ch·ªçn: "+videoFile.name;
});

async function processVideo(){
    if(!videoFile) return alert("Ch∆∞a ch·ªçn video");
    const status = document.getElementById("status");
    status.innerText = "Load FFmpeg...";
    if(!ffmpeg.isLoaded()) await ffmpeg.load();

    const data = await fetchFile(videoFile);
    ffmpeg.FS('writeFile','input.mp4',data);

    status.innerText = "T√°ch MP3...";
    await ffmpeg.run('-i','input.mp4','-vn','-acodec','libmp3lame','audio.mp3');
    const mp3Data = ffmpeg.FS('readFile','audio.mp3');
    const mp3Blob = new Blob([mp3Data.buffer],{type:'audio/mpeg'});

    status.innerText = "Nh·∫≠n di·ªán ti·∫øng Trung...";
    const reader = new FileReader();
    reader.readAsArrayBuffer(mp3Blob);
    reader.onload = async ()=>{
        const audioData = new Uint8Array(reader.result);
        const text = await WhisperTiny.transcribe(audioData,{language:"zh"});
        document.getElementById("chinaText").value = text;

        status.innerText = "D·ªãch sang Vi·ªát...";
        const viet = await Translate(text,{from:"zh",to:"vi"});
        document.getElementById("vietText").value = viet;
        document.getElementById("vietInput").value = viet;

        status.innerText = "Xong! C√≥ th·ªÉ ch·ªânh s·ª≠a input v√† copy.";
    }
}

function copyAll(){
    const input = document.getElementById("vietInput");
    input.select();
    input.setSelectionRange(0, 99999);
    document.execCommand("copy");
    alert("ƒê√£ copy to√†n b·ªô vƒÉn b·∫£n!");
}
</script>

</body>
</html>
